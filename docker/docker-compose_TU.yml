version: "2.1"

services:
  <CONTAINER_NAME>:
    image: <IMAGE>
    container_name: <CONTAINER_NAME>
    entrypoint:
      [
        "./qc-result-validator"
      ]
    networks: [ "traefik" ]
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/TZ:ro
    mem_limit: "100m"
    memswap_limit: "150m"
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik"
      - "traefik.http.services.<PROJECT_NAME>.loadbalancer.server.port=8080"

      - "traefik.http.routers.<PROJECT_NAME>.rule=PathPrefix(`/<CONTAINER_NAME>`)"
      - "traefik.http.routers.<PROJECT_NAME>.middlewares=<CONTAINER_NAME>_pathstrip@docker"
      - "traefik.http.routers.<PROJECT_NAME>.tls=true"

      - "traefik.http.middlewares.<PROJECT_NAME>_pathstrip.stripprefix.prefixes=/<CONTAINER_NAME>"
    environment:
      CUSTOMER: <CUSTOMER>
      ENVIRONMENT: <ENVIRONMENT>
      GOOGLE_APPLICATION_CREDENTIALS: "/google-account-key.json"
      GCLOUD_PROJECT_ID: "setlog-rossmann-qc"
      GCLOUD_LOCATION: "europe-west3"
      GCLOUD_BUCKETNAME: "gs://<BUCKETNAME>/delivery"
    restart: always

networks:
  traefik:
    external: true