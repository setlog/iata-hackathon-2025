version: "2"

services:
  <CONTAINER_NAME>:
    image: <IMAGE>
    container_name: <CONTAINER_NAME>
    entrypoint:
      [
        "./qc-result-validator"
      ]
    networks: [ "traefik" ]
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/TZ:ro
    mem_limit: "100m"
    memswap_limit: "150m"
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik"
      - "traefik.http.services.<PROJECT_NAME>.loadbalancer.server.port=8000"

      - "traefik.http.routers.<PROJECT_NAME>.rule=PathPrefix(`/<CONTAINER_NAME>`)"
      - "traefik.http.routers.<PROJECT_NAME>.entrypoints=https"
      - "traefik.http.routers.<PROJECT_NAME>.tls=true"
      
      - "traefik.http.middlewares.<PROJECT_NAME>-strip.stripprefix.prefixes=/<CONTAINER_NAME>"
      # override default prometheus metrics path
      - "prometheus.metrics-path=/metrics"
    environment:
      CUSTOMER: <CUSTOMER>
      ENVIRONMENT: <ENVIRONMENT>
      GOOGLE_APPLICATION_CREDENTIALS: "/google-account-key.json"
      GCLOUD_PROJECT_ID: "setlog-rossmann-qc"
      GCLOUD_LOCATION: "europe-west3"
      GCLOUD_BUCKETNAME: "gs://<BUCKETNAME>/delivery"
    restart: always

networks:
  traefik:
    external:
      name: traefik